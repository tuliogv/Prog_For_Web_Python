<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Jogo da Cobrinha</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <style>
    :root{
      --bg: #0b1020; --panel:#10172a; --text:#e5e7eb; --muted:#9ca3af;
      --accent:#60a5fa; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
      --grid:#1f2937; --snake:#34d399; --snake2:#10b981; --food:#fb7185;
      --shadow: 0 10px 24px rgba(0,0,0,.35);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f3f4f6; --panel:#ffffff; --text:#111827; --muted:#374151; --grid:#e5e7eb; --shadow:0 10px 18px rgba(0,0,0,.12) }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:15px/1.6 system-ui, -apple-system, Segoe UI, Roboto;
      background:
        radial-gradient(900px 500px at 100% -10%, rgba(96,165,250,.15), transparent 60%),
        radial-gradient(700px 400px at -10% 10%, rgba(168,85,247,.18), transparent 60%),
        linear-gradient(180deg, var(--bg), #0b1224);
      color:var(--text); touch-action:none;
    }
    .wrap{max-width:980px;margin:0 auto;padding:22px 14px 40px}
    header{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:14px}
    h1{margin:0;font-size:clamp(22px,3vw,30px)}
    .muted{color:var(--muted)}
    .panel{
      background:var(--panel); border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:14px; box-shadow:var(--shadow); backdrop-filter: blur(6px);
    }
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media (min-width:900px){ .grid{grid-template-columns:1fr 320px} }

    .stats{display:flex;gap:10px;flex-wrap:wrap}
    .chip{border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.04)}
    .chip strong{letter-spacing:.3px}

    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    button, select{
      appearance:none;border:1px solid rgba(255,255,255,.14);background:#0f172a;color:var(--text);
      padding:8px 12px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);
    }
    button:hover,select:hover{border-color:rgba(96,165,250,.45)}
    button.primary{background:linear-gradient(135deg,#0ea5e9,#7c3aed);border-color:transparent;color:#fff;font-weight:600}
    button.ghost{background:rgba(255,255,255,.06)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    label{display:flex;align-items:center;gap:8px;cursor:pointer}

    /* √Årea do jogo */
    .stage{
      position:relative; border-radius:16px; overflow:hidden; border:1px solid rgba(255,255,255,.12);
      background:
        linear-gradient(180deg, rgba(0,0,0,.2), rgba(0,0,0,.1)),
        repeating-linear-gradient(0deg, transparent 0 22px, rgba(255,255,255,.03) 22px 23px),
        repeating-linear-gradient(90deg, transparent 0 22px, rgba(255,255,255,.03) 22px 23px),
        radial-gradient(1200px 600px at -20% -40%, rgba(16,185,129,.15), transparent 70%);
      box-shadow: var(--shadow);
    }
    canvas{display:block;width:100%;height:auto;image-rendering:pixelated}
    .overlay{
      position:absolute;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.35);
      color:#fff;text-align:center;padding:20px;backdrop-filter: blur(2px);
      opacity:0;pointer-events:none;transition:opacity .2s ease;
    }
    .overlay.show{opacity:1;pointer-events:auto}
    .overlay h2{margin:0 0 6px;font-size:clamp(22px,3.2vw,32px)}
    .overlay .sub{opacity:.9}

    /* D-Pad para mobile */
    .dpad{
      margin-top:10px; display:grid; grid-template-areas:
        ". up ."
        "left mid right"
        ". down .";
      gap:8px; width:min(320px, 80%); margin-inline:auto;
      user-select:none;
    }
    .dpad button{
      aspect-ratio:1/1; font-size:20px; padding:0; border-radius:12px;
      background:rgba(255,255,255,.08);
    }
    .dpad .up{grid-area:up} .dpad .down{grid-area:down}
    .dpad .left{grid-area:left} .dpad .right{grid-area:right}
    .dpad .mid{grid-area:mid;visibility:hidden}
    footer{text-align:center;margin-top:16px;color:var(--muted);font-size:13px}
    a{color:#93c5fd}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>üêç Jogo da Cobrinha</h1>
        <div class="muted">Setas / WASD para mover ‚Ä¢ Espa√ßo: Pausar ‚Ä¢ R: Reiniciar ‚Ä¢ Toque ou deslize no celular</div>
      </div>
      <div class="stats">
        <span class="chip">Pontua√ß√£o: <strong id="score">0</strong></span>
        <span class="chip">Recorde: <strong id="best">0</strong></span>
        <span class="chip">Velocidade: <strong id="spdLabel">Normal</strong></span>
      </div>
    </header>

    <div class="grid">
      <section class="panel">
        <div class="row" style="margin-bottom:10px">
          <div class="controls">
            <button id="startBtn" class="primary">‚ñ∂Ô∏è Iniciar</button>
            <button id="pauseBtn" class="ghost">‚è∏Ô∏è Pausar</button>
            <button id="resetBtn" class="ghost">üîÑ Reiniciar</button>
          </div>
          <div class="controls">
            <label title="Quando ativo, atravessar a borda faz a cobra aparecer do outro lado.">
              <input type="checkbox" id="wrapChk"> Wrap nas bordas
            </label>
            <label>
              Dificuldade:
              <select id="speedSel">
                <option value="170">Calmo</option>
                <option value="130" selected>Normal</option>
                <option value="95">R√°pido</option>
                <option value="70">Insano</option>
              </select>
            </label>
          </div>
        </div>

        <div class="stage">
          <canvas id="game" width="504" height="504" aria-label="Tabuleiro do jogo"></canvas>
          <div id="overlayStart" class="overlay show" role="dialog" aria-live="polite">
            <div>
              <h2>Pronto para jogar?</h2>
              <div class="sub">Pressione <strong>Iniciar</strong> ou <strong>Espa√ßo</strong>.</div>
            </div>
          </div>
          <div id="overlayPause" class="overlay" role="dialog" aria-live="polite">
            <div>
              <h2>Pausado</h2>
              <div class="sub">Espa√ßo para voltar ‚Ä¢ Ajuste a dificuldade se quiser</div>
            </div>
          </div>
          <div id="overlayOver" class="overlay" role="dialog" aria-live="polite">
            <div>
              <h2>Game Over</h2>
              <div class="sub">Pressione <strong>R</strong> ou clique em <strong>Reiniciar</strong></div>
            </div>
          </div>
        </div>

        <div class="dpad" aria-label="Controles de dire√ß√£o (mobile)">
          <button class="up" data-dir="0,-1">‚ñ≤</button>
          <button class="left" data-dir="-1,0">‚óÄ</button>
          <button class="mid" disabled></button>
          <button class="right" data-dir="1,0">‚ñ∂</button>
          <button class="down" data-dir="0,1">‚ñº</button>
        </div>

        <footer>
          Feito com ‚ô• ‚Ä¢ <a href="#" onclick="location.reload()">Recarregar</a>
        </footer>
      </section>

      <aside class="panel">
        <h3 style="margin-top:0">Como jogar</h3>
        <ul style="margin:8px 0 12px 18px">
          <li>Use <strong>setas</strong> ou <strong>WASD</strong> para mover.</li>
          <li>Coma a <strong>comida</strong> (‚óè) para crescer e ganhar pontos.</li>
          <li>Evite colidir com o pr√≥prio corpo (ou com as paredes se o wrap estiver desativado).</li>
          <li><strong>Espa√ßo</strong> pausa/retoma, <strong>R</strong> reinicia.</li>
        </ul>
        <p class="muted">Dica: no modo <em>Wrap nas bordas</em>, d√° para planejar trajet√≥rias passando de um lado ao outro do tabuleiro.</p>
        <hr style="border:none;border-top:1px dashed rgba(255,255,255,.18);margin:14px 0">
        <p class="muted">Este jogo √© 100% client-side; o recorde fica salvo via <code>localStorage</code>.</p>
      </aside>
    </div>
  </div>

  <script>
  (() => {
    // ======= Configura√ß√£o b√°sica =======
    const GRID = 21;              // 21x21 c√©lulas
    const SIZE = 504;             // pixels do canvas (quadrado)
    const CELL = SIZE / GRID;     // tamanho de cada c√©lula
    const SPEED_DEFAULT = 130;    // ms por tick
    const COLORS = {
      grid: getCSS('--grid'),
      snake: getCSS('--snake'),
      snake2: getCSS('--snake2'),
      food: getCSS('--food')
    };

    // ======= Estado do jogo =======
    let snake, dir, dirQueue, food, score, best, timer = null, speed = SPEED_DEFAULT;
    let playing = false, paused = false, gameOver = false, wrap = false;
    let changedThisTick = false;

    // ======= Elementos =======
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');
    const $score = document.getElementById('score');
    const $best = document.getElementById('best');
    const $spdLabel = document.getElementById('spdLabel');
    const $start = document.getElementById('startBtn');
    const $pause = document.getElementById('pauseBtn');
    const $reset = document.getElementById('resetBtn');
    const $speed = document.getElementById('speedSel');
    const $wrap = document.getElementById('wrapChk');
    const $ovStart = document.getElementById('overlayStart');
    const $ovPause = document.getElementById('overlayPause');
    const $ovOver  = document.getElementById('overlayOver');

    // Ajuste visual (responsivo simples)
    cvs.style.maxWidth = '100%';
    cvs.style.height = 'auto';

    // Recorde salvo
    best = Number(localStorage.getItem('snakeHigh') || 0);
    $best.textContent = best;

    // ======= Inicializa√ß√£o =======
    function resetGame(){
      const mid = Math.floor(GRID/2);
      snake = [
        {x: mid-1, y: mid},
        {x: mid,   y: mid},
        {x: mid+1, y: mid}
      ];
      dir = {x: 1, y: 0};
      dirQueue = [];
      score = 0;
      updateScore(0);
      food = spawnFood();
      playing = false; paused = false; gameOver = false;
      changedThisTick = false;
      draw();
      showOverlay('start');
    }

    function startGame(){
      if (gameOver) resetGame();
      if (playing && !paused) return;
      playing = true; paused = false;
      hideOverlays();
      runLoop();
    }

    function pauseGame(){
      if (!playing || gameOver) return;
      paused = !paused;
      if (paused) {
        stopLoop();
        showOverlay('pause');
      } else {
        hideOverlays();
        runLoop();
      }
    }

    function endGame(){
      gameOver = true; playing = false;
      stopLoop();
      if (score > best){
        best = score;
        localStorage.setItem('snakeHigh', String(best));
        $best.textContent = best;
      }
      showOverlay('over');
    }

    function runLoop(){
      stopLoop();
      timer = setInterval(tick, speed);
    }
    function stopLoop(){
      if (timer) clearInterval(timer);
      timer = null;
    }

    // ======= Mec√¢nica =======
    function tick(){
      // Consome pr√≥xima dire√ß√£o (se houver)
      if (dirQueue.length){
        const next = dirQueue.shift();
        dir = next;
      }
      changedThisTick = false;

      const head = snake[snake.length - 1];
      let nx = head.x + dir.x;
      let ny = head.y + dir.y;

      if (wrap){
        nx = (nx + GRID) % GRID;
        ny = (ny + GRID) % GRID;
      } else {
        if (nx < 0 || nx >= GRID || ny < 0 || ny >= GRID){
          endGame(); return;
        }
      }

      const newHead = {x: nx, y: ny};

      // Colis√£o com o pr√≥prio corpo
      if (snake.some(seg => seg.x === newHead.x && seg.y === newHead.y)){
        endGame(); return;
      }

      snake.push(newHead);

      // Comeu?
      if (newHead.x === food.x && newHead.y === food.y){
        score += 10;
        updateScore(score);
        food = spawnFood();
      } else {
        snake.shift(); // move sem crescer
      }

      draw();
    }

    function updateScore(v){
      $score.textContent = v;
    }

    function spawnFood(){
      let p;
      do {
        p = { x: randInt(0, GRID-1), y: randInt(0, GRID-1) };
      } while (snake && snake.some(s => s.x === p.x && s.y === p.y));
      return p;
    }

    // ======= Desenho =======
    function draw(){
      // Fundo
      ctx.clearRect(0,0,SIZE,SIZE);
      drawGrid();

      // Comida
      drawCell(food.x, food.y, COLORS.food, true);

      // Cobra
      for (let i = 0; i < snake.length; i++){
        const seg = snake[i];
        // gradiente leve no corpo
        const t = i / (snake.length - 1 || 1);
        const col = mixColor(COLORS.snake2, COLORS.snake, t);
        drawCell(seg.x, seg.y, col);
      }

      // Olhos na cabe√ßa
      const head = snake[snake.length-1];
      drawEyes(head, dir);
    }

    function drawGrid(){
      ctx.fillStyle = 'rgba(0,0,0,.18)';
      ctx.fillRect(0,0,SIZE,SIZE);
      ctx.strokeStyle = COLORS.grid;
      ctx.lineWidth = 1;
      ctx.beginPath();
      for (let i=1;i<GRID;i++){
        const p = i*CELL + .5;
        ctx.moveTo(p, 0); ctx.lineTo(p, SIZE);
        ctx.moveTo(0, p); ctx.lineTo(SIZE, p);
      }
      ctx.stroke();
    }

    function drawCell(x,y,color,rounded=false){
      const pad = 2;
      const r = rounded ? 6 : 4;
      const sx = x*CELL + pad;
      const sy = y*CELL + pad;
      const s = CELL - pad*2;
      roundRect(ctx, sx, sy, s, s, r);
      ctx.fillStyle = color;
      ctx.fill();
      // brilho sutil
      const g = ctx.createRadialGradient(sx+s*0.3, sy+s*0.3, 2, sx, sy, s);
      g.addColorStop(0, 'rgba(255,255,255,.12)');
      g.addColorStop(1, 'rgba(255,255,255,0)');
      ctx.fillStyle = g;
      roundRect(ctx, sx, sy, s, s, r); ctx.fill();
    }

    function drawEyes(head, dir){
      const cx = head.x*CELL, cy = head.y*CELL;
      const ex = dir.x === 0 ? CELL*0.3 : (dir.x > 0 ? CELL*0.6 : CELL*0.2);
      const ey = dir.y === 0 ? CELL*0.3 : (dir.y > 0 ? CELL*0.6 : CELL*0.2);
      ctx.fillStyle = '#fff';
      ctx.beginPath(); ctx.arc(cx + CELL*0.35, cy + CELL*0.35, 3, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(cx + ex, cy + ey, 3, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = '#111827';
      ctx.beginPath(); ctx.arc(cx + CELL*0.35, cy + CELL*0.35, 1.3, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(cx + ex, cy + ey, 1.3, 0, Math.PI*2); ctx.fill();
    }

    // ======= Entradas =======
    window.addEventListener('keydown', e => {
      const k = e.key.toLowerCase();
      const map = {
        arrowup:{x:0,y:-1},    w:{x:0,y:-1},
        arrowdown:{x:0,y:1},   s:{x:0,y:1},
        arrowleft:{x:-1,y:0},  a:{x:-1,y:0},
        arrowright:{x:1,y:0},  d:{x:1,y:0}
      };
      if (k in map){
        e.preventDefault();
        queueDir(map[k]);
      } else if (k === ' '){
        e.preventDefault();
        if (!playing) startGame(); else pauseGame();
      } else if (k === 'r'){
        e.preventDefault();
        resetGame();
      }
    }, { passive:false });

    // D-Pad (toque/click)
    document.querySelectorAll('.dpad button[data-dir]').forEach(btn=>{
      btn.addEventListener('click', () => {
        const [x,y] = btn.dataset.dir.split(',').map(Number);
        queueDir({x,y});
      });
      btn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const [x,y] = btn.dataset.dir.split(',').map(Number);
        queueDir({x,y});
      }, { passive:false });
    });

    // Swipe (mobile)
    let tStart = null;
    window.addEventListener('touchstart', e => {
      if (!e.touches[0]) return;
      tStart = {x:e.touches[0].clientX, y:e.touches[0].clientY};
    }, { passive:true });
    window.addEventListener('touchend', e => {
      if (!tStart) return;
      const t = e.changedTouches[0];
      const dx = t.clientX - tStart.x;
      const dy = t.clientY - tStart.y;
      const ax = Math.abs(dx), ay = Math.abs(dy);
      if (Math.max(ax,ay) > 20){
        if (ax > ay) queueDir({x: dx>0?1:-1, y:0});
        else queueDir({x:0, y: dy>0?1:-1});
      }
      tStart = null;
    });

    function queueDir(n){
      if (changedThisTick) {
        // J√° trocou nesse tick, empilha para o pr√≥ximo
      }
      const last = dirQueue[dirQueue.length-1] || dir;
      if (n.x === -last.x && n.y === -last.y) return; // evita 180¬∫ instant√¢neo
      dirQueue.push(n);
      changedThisTick = true;
    }

    // Bot√µes UI
    $start.addEventListener('click', startGame);
    $pause.addEventListener('click', pauseGame);
    $reset.addEventListener('click', resetGame);
    $speed.addEventListener('change', () => {
      speed = Number($speed.value);
      $spdLabel.textContent = labelSpeed(speed);
      if (playing && !paused){ runLoop(); }
    });
    $wrap.addEventListener('change', () => { wrap = $wrap.checked; });

    function labelSpeed(ms){
      if (ms <= 75) return 'Insano';
      if (ms <= 100) return 'R√°pido';
      if (ms <= 140) return 'Normal';
      return 'Calmo';
    }

    // ======= Overlays =======
    function hideOverlays(){ $ovStart.classList.remove('show'); $ovPause.classList.remove('show'); $ovOver.classList.remove('show'); }
    function showOverlay(type){
      hideOverlays();
      if (type === 'start') $ovStart.classList.add('show');
      if (type === 'pause') $ovPause.classList.add('show');
      if (type === 'over')  $ovOver.classList.add('show');
    }

    // ======= Util =======
    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min }
    function roundRect(ctx,x,y,w,h,r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }
    function mixColor(a,b,t){
      const ca = hexToRgb(a), cb = hexToRgb(b);
      const r = Math.round(ca.r+(cb.r-ca.r)*t);
      const g = Math.round(ca.g+(cb.g-ca.g)*t);
      const bl= Math.round(ca.b+(cb.b-ca.b)*t);
      return `rgb(${r},${g},${bl})`;
    }
    function hexToRgb(hex){
      const m = hex.replace('#','');
      const n = m.length===3 ? m.split('').map(c=>c+c).join('') : m;
      return { r:parseInt(n.slice(0,2),16), g:parseInt(n.slice(2,4),16), b:parseInt(n.slice(4,6),16) };
    }
    function getCSS(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim() || '#fff' }

    // ======= Come√ßa pronto =======
    // Valores iniciais da UI
    speed = Number($speed.value);
    $spdLabel.textContent = labelSpeed(speed);
    wrap = $wrap.checked;

    resetGame();
  })();
  </script>
</body>
</html>
